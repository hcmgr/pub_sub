CC=gcc
FLAGS=-g -fPIC -pedantic -Wall -std=gnu99
LIB_STRING_MAP_LIB=-L/local/courses/csse2310/lib -lstringmap
A4_HEADER=-I/local/courses/csse2310/include
A4_LIB=-L/local/courses/csse2310/lib -lcsse2310a4
A3_LIB=-L/local/courses/csse2310/lib -lcsse2310a3
PTHREAD=-pthread
LIB_STRING_HEADER=-I/local/courses/csse2310/include

all: client server shared libstringmap.so

client: client.c shared.o
	$(CC) $(FLAGS) $(A4_HEADER) $(A4_LIB) ${A3_LIB} $(PTHREAD) \
	    -o psclient $^ 

server: server.c clientList.c shared.o 
	$(CC) $(FLAGS) $(A4_HEADER) $(A4_LIB) $(A3_LIB) $(PTHREAD) \
	$(LIB_STRING_MAP_LIB) \
	    -o psserver $^ 

shared: shared.c 
	$(CC) $(FLAGS) -c -o shared.o $^

stringmap.o: stringmap.c
	$(CC) $(FLAGS) -fPIC $(LIB_STRING_HEADER) \
	-c $<

libstringmap.so: stringmap.o
	$(CC) -shared -o $@ stringmap.o

stringmaptest: stringmaptest.c
	$(CC) $(A4_HEADER) $(LIB_STRING_MAP_LIB) -o $@ $^

clean:
	rm psclient
	rm psserver
	rm shared.o
	rm libstringmap.so
	rm stringmaptest

outs:
	rm *.stderr
	rm *.stdout
	



