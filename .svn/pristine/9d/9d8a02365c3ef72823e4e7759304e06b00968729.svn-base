#include "stringmap.h"
#include <stdlib.h>
#include <stdio.h>

/* This defines the Topic structure. This is a structure to be held
 * in a linked list that stores the StringMapItem corresponding to the topic 
 * and a pointer to the next in the list.
 * */
typedef struct { 
    StringMapItem* item;
    StringMapListItem* next;
} Topic*

/* This is a structure to define the StringMap. It simply holds the head of 
 * a linked list of Topic structures.
 * */
struct StringMap { 
    Topic* head;
}

StringMap* stringmap_init() {
    //Our stringmap is a linked list of Topic structures, each of which stores
    //a StringMapItem and a next pointer
    StringMap* sm = calloc(1, sizeof(StringMap));
    //initialise head of linked list
    Topic* head = calloc(1, sizeof(StringMapListItem));
    head->item = NULL;
    head->next = NULL;
    sm->head = head;
    return sm;
}

void stringmap_free(StringMap* sm) {

}

void* stringmap_search(StringMap* sm, char* key) {
    //stringMap or key is NULL
    if (!sm || !key) {
        return NULL;
    }

    Topic* prev = NULL;
    Topic* currTopic = currTopic;
    while (currTopic) {
        if (!strcmp(currTopic->item->key, key)) {
            return currTopic; //found
        }
        currTopic = currTopic->next;
    }
    //not found
    return NULL;
}

int stringmap_add(StringMap* sm, char* key, void* item) {
    //check no arguments are NULL
    if (!sm || !key || !item) {
        return 0;
    }

    //check item not alreay present
    if (stringmap_search(sm, key)) {
        return 0;
    }

    //create StringMapItem for given key and item
    StringMapItem* smi = calloc(1, sizeof(StringMapItem));
    smi->key = key;
    smi->item = item;

    //create new Topic structure to store this item in the StringMap
    Topic* topicToAdd = calloc(1, sizeof(StringMapListItem));
    topicToAdd->item = smi;
    topicToAdd->next = NULL;

    //add Topic structure to StringMap
    Topic* currTopic = sm->head;
    while (currTopic->next) {
        currTopic = currTopic->next;
    }
    currTopic->next = topic;
    return 1;

}

int stringmap_remove(StringMap* sm, char* key) {

}

StringMapItem* stringmap_iterate(Stringmap* sm, StringMapItem* prev) {
    //stringMap null
    if (!sm) {
        return NULL;
    }
    if (!prev) {
        return sm->head; //return first entry
    }
    return prev->next; //return next entry
}




 

